[首页](/#index) / [Vim](/vim-docs/) / [vim解决问题的方式](solve)

# vim解决问题的方式

从本质上讲，我们的工作是重复性的。不论是在几个不同的地方做相同的小改动，还是在文档的相似结构间移动，我们都会重复很多操作。凡是可以简化重复性操作的方式，都会成倍地节省我们的时间。
 
Vim对重复性操作进行了优化。它之所以能高效地重复，是因为它会记录我们最近的操作，让我们用一次按键就能重复上次的修改。这听起来很强大，但是除非我们能够学会规划按键动作，使得在重复时能完成一项有用的工作，否则这没什么用。掌握这一理念是高效使用Vim的关键。
 
我们将以 `.` 命令作为开始。这个看似简单的命令是Vim中的瑞士军刀，掌握它的用法是精通Vim的第一步。我们将运行一些可由 `.` 命令快速完成的简单编辑任务，虽然每个任务彼此之间截然不同，但解决的方法却大同小异。我们将找到一种理想的编辑模式，**即用一次按键移动，用另一次按键执行**。

## 技巧1 认识 . 命令

?> `.` 命令可以让我们重复上次的修改，它是vim中最为强大的多面手

操作文本

```tex
Line one
Line two
Line three
Line four
```

`.` 命令可以让我们重复上次的修改

`x` 命令会删除光标下的字符，在这种情况下使用 `.` 命令“重复上次修改”时，就会让Vim删除光标下的字符。

> 提示: 按 <kbd>u</kbd> 可以撤销上一次的操作，多按几次恢复初始状态

`dd` 命令会删除光标当前行，按 `dd` 后再按 `.` 也会删除当前行

最后 `>G` 命令会增加从当前行到文档末尾处的缩进层级。可以按 `>G` 后换一行使用 `.`，看看效果

!> `x`、`dd` 以及 `>` 命令都是在普通模式中执行的命令，不过，每次进入插入模式，也会形成一次修改。从进入插入模式的那一刻起(按 `i`)，直到按 `esc` 回到普通模式为止，vim会记录每一个按键操作。做出这样一个修改后再用 `.` 命令的话，它将会重新执行所有这些按键操作

`.` 命令是一个微型的宏

Vim可以录制任意数目的按键操作，然后在以后重复执行它们。这让我们可以把最常重复的工作流程录制下来，并用一个按键重放它们。可以把 `.` 命令当成一个很小的宏

---

## 技巧2 不要自我重复

对于在行尾添加内容这样的常见操作，如添加分号，Vim提供了一个专门的命令，可以把两步操作合并为一步

我们想在每行的结尾添加一个分号。要实现这一点，先得把光标移到行尾，然后切换到插入模式进行修改。`$` 命令可以完成移动动作，接着就可以执行 `a;< Esc >` 完成修改了
 
要完成全部修改，也可以对下面两行做完全相同的操作，不过那样做会错过这里将要提到的小窍门。由于 `.` 命令可以重复上次的修改，因此不必重复之前的操作，而是执行两次 `j$.`

操作文本

```js
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

### 减少无关的移动

`a` 命令在当前光标之后添加内容， `A` 命令则在当前行的结尾添加内容。不管光标当前处于什么位置，输入 `A` 都会进入插入模式，并把光标移到行尾。

`A` 把 `$a` 封装成了一个按键操作。

用 `A` 来代替 `$a`，大大提升了 `.` 命令的效率。不必再把光标移到行尾，只需保证它位于该行内就行了（可在任意位置）。现在可以重复执行足够多次的 `j.` ，完成对后续行的修改。

一键移动，另一键操作，真是太完美了！请留意这种应用模式，因为我们即将在更多的例子中看到它的身影。

### 一箭双雕

我们可以这样说 `A` 命令把两个动作(`$a`)合并成了一次按键。不过它不是唯一一个这样的命令，很多vim的单键命令都可以被看到两个或多个其他命令的组合，下表列出了类似的例子

|复合命令|等效的长命令|
|:---|:---|
|`C`|`c$` 删空光标后面的所有东西，并进入插入模式|
|`s`|`cl` 往后删一个字符，并进入插入模式|
|`S`|`^C` 删空这行，并进入插入模式|
|`I`|`$i` 到达行首，并进入插入模式|
|`A`|`$a` 到达行尾，并进入插入模式|
|`o`|`A<CR>` 下面插入一个空行，并进入插入模式|
|`O`|`ko` 在上面新建一个空行，并进入插入模式|

虽然这一模式对简短的文本来说很好用，但它不是万能的。如果文本有50行，我们是不是要按50次？不急，跳到[技巧30]()可以看到另一种解法

---

## 技巧3 以退为进

我们可以用一种常用的Vim操作习惯在一个字符前后各添加一个空格。
假设有一行代码看起来是这样的：

```js
var foo = "method("+argument1+","+argument2+")";
```

在 JavaScript 里把字符串连接到一起从来都不美观，但可以像下面这样在 + 号前后各添加一个空格，让肉眼更容易识别。

```js
var foo = "method(" + argument1 + "," + argument2 + ")";
```

### 使修改可重复

按 `f+` 定位到第一个 + 号的位置，按 `s <Space> + <Space> <Esc>` ，按 `;` 按 `.` 按 `;.`，按 `;.`

知识点:

`f{char}`在行内查找下一个指定的字符，使用 `；`与 `,` 进行前进与退回

`s` 命令把两个操作合并为一个: 它先删除光标下的字符，然后进入insert模式。在删除 + 号后，先输入`<space> + <space>`，然后按键 `<ESC>` 退出插入模式

先后退一步，然后前进三步，这是个奇怪的小花招，看起来可能不够直接。但这样做最大的好处是：我们可以用 `.` 命令重复这一修改。我们所要做的只是把光标移到下一个 + 号处，然后用 `.` 命令重复这一操作即可。

```
/{pattern} 在文档内查找下一处匹配的项; (用 n 和 N 进行向上查找与向下查找)
* 表示向下查找光标处的单词
#表示向上查找光标处的单词
```

### 使移动可重复

本例中还有一个小技巧。`f{char}` 命令 让vim 查找下一处指定字符出现的位置，如果找到了，就把光标移动到那里(参见 `:h f`)。[技巧50]()将会学到更多关于`f{char}`命令的知识

完成第一次修改后，可以重复按 `f+` 跳到下一个 + 号的位置，不过，还有一种更好的方法可以用 `;` ，`;` 命令会重复查找上次 `f` 命令查找的字符，因此不用输入4次 `f+` ，而是值输入一次，后面跟着再用3次 `;` 命令

### 合二为一

`;` 命令带我们到下一个目标字符上， `.` 命令则重复上次的修改。因此，可以连续输入3次 `;.` 来完成全部修改。看起来是不是很熟悉


## 技巧4 执行、重复、回退

在面对重复性工作时，我们需要让移动动作和修改都能够重复，这样就可以达到最佳编辑模式。
如果我们知道如何重复之前的操作，而无需每次都输入整条命令，那么就会获得更高的效率。可以先执行一次，随后只需重复即可。

我们已经看到 `.` 命令会重复上一次修改。由于很多操作都被当成一次修改，因此 `.` 命令已经证明了它的神通广大。但是有些命令能以其他方式重复。例如: `@:` 可以用来重复任意 Ex 命令(在[技巧31]()中讨论)，或者也可以输入 `&` (参见[技巧93]())来重复上次 :substitute命令 (它本身也是一条Ex命令)

当一遍又一遍地连续按 `j.j.j.` 时，那种感觉就像是在敲鼓。可是，如果不小心在一行上敲了两次 `j` 键，会发生什么？或是更糟，敲了两次 `.` 键？对 `.` 命令而言，我们永远可以按 `u` 键撤销上次的修改。在多数场景中，撤销（undo）都是我们想要使用的命令。如果在使用 `f{char}` 命令后，不少心按了太多次 `;` 键，就会偏离我们的目标。不过可以再次按 `,` 键跳回去，这个命令会反向查找上次 `f{char}` 所查找的字符(参见[技巧50]())

### 可重复的操作和如何回退

|目的|操作|重复|回退|
|:---|:---|:---|:---|
|做出一个修改|{edit}|`.`|`u`|
|在行内查找下一个指定字符|`f{char}/t{char}`|`;`|`,`|
|在行内查找上一个指定字符|`F{char}/T{char}`|`;`|`,`|
|在文档中查找下一处匹配项|/pattern`<CR>`|`n`|`N`|
|在文档中查找上一处匹配项}|?pattern`<CR>`|`n`|`N`|
|执行替换|:s/target/replacement|`&`|`u`|
|执行一系列修改|`qx{changes}q`|`@x`|`u`|

## 技巧5 查找并手动替换

Vim提供了一个 :substitute 命令专门用于查找替换任务， 不过用上面介绍的技术，也可以手动修改第一处地方，然后再一 个个地查找替换其他匹配项。`.` 命令可以把我们从繁重的工作中解放出来，而即将登场的另一个有用的单键命令则能够让我们方便地在匹配项间跳转。

在下面这段文本中，每一行都出现了单词“content”

```text
asdaldas;ld content asd;alskda;ldkas;d

adasd content askdas;djaslkdjalksjda;sd asda

1111231as;kdalsdk;la;am.,mc. alsdkasl; content ...
```

假设想用单词“copy”（意义同“copywriting”）来替代“content”。也许你会想，这太简单了，只要用替换命令就行了，像下面这样：

```shell
:%s/content/copy/g
```

但是，且慢！如果我们运行上面这条命令，就会出现“If you are ‘copy’ with this,”这样的句子，这很荒唐！
 
我们不能想当然地用“copy”替换每一个“content”，而是要时刻留神，对每个地方都要问“这里要修改吗？”，然后回答“修改”或者“不改”。

### 偷懒的方法: 无需输入就可以进行查找

`.` 命令是我最喜爱的Vim单键命令，而排在第二位的是 `*` 命令，此命令可以查找当前光标下的单词(参见`:h *`)
 
我们可以调出查找提示符，并输入完整的单词来查找“content”。

```shell
/content
```

或者，可以简单地把光标移到这个单词上，然后按 * 键。以下面的操作为例

![例子](/example/1.gif)

### 使修改可重复

当光标位于“content”的开头时，就可以着手修改它。这包括两步操作：首先要删除单词“content”，然后输入替代的单词。

`cw` 命令会删除从光标位置到单词结尾的字符，并进入插入模式，然后就可以输入单词“copy”了。Vim会把我们离开插入模式之前的全部按键操作都记录下来，因此整个 `cwcopy<Esc>`会被当成一个修改。也就是说，执行 `.` 命令会删除从光标到当前单词结尾间的字符，并把它修改为“copy”。

### 合而为一

万事俱备！每次按 <kbd>n</kbd> 键时，光标就会跳到下一个“content”单词所在之处，而按 `.` 键时，它就会把光标下的单词改为“copy”。如果想替换所有地方，就可以不加思考地一直按 `n.n.n.` 以完成所有的修改（但是，这种情况下也可以用 :%s/content/copy/g 命令）。

## 技巧6 认识 . 范式

到目前为止，我们介绍了3个简单的编辑任务。尽管每个问题都不一样，不过我们都找到了用 . 命令解决该问题的方法。在本节，我们将比较这些方案，并找出它们共有的模式——一个我称之为“ . 范式”的最佳编辑模式。

### 回顾前面3个 . 命令编辑任务

在技巧2中，我们想在一系列行的结尾添加分号。我们先用 `A`;<Esc> 修改了第一行，做完这步准备后，就可以使用 `.` 命令对后续行重复此修改。我们使用了 `j` 命令在行间移动，要完成剩余的修改，只需简单地按足够多次 `j.` 就可以了。

在技巧3中，我们想为每个 + 号的前后各添加一个空格。先用 `f+` 命令跳到目标字符上，然后用 `s` 命令把一个字符替换成3个，做完这步准备后，就可以按若干次 `;.` 完成此任务。

在技巧5中，我们想把每处出现单词“content”的地方都替换成“copy”。使用 `*` 命令来查找目标单词，然后用 `cw` 命令修改第一处地方。做完这步准备后，就可以用 `n` 键跳到下一匹配项，然后用 `.` 键做相同的修改。要完成这项任务，只需简单地按足够多次 `n.` 就行了。


### 理想模式：用一键移动，另一键执行

所有这些例子都利用 `.` 命令重复上次的修改，不过这不是它们唯一的共同点，另外的共同点是它们都只需要按一次键就能把光标移到下一个目标上。
用一次按键移动，另一次按键执行，再没有比这更好的了，不是吗？这就是我们的理想解决方案。我们将会一次又一次地看到这一编辑模式，所以为了方便起见，把它叫做“`.` 范式”。
